<!--<pre>{{fullJson | json}}</pre>-->
<div id="saveMessage"><span>Save</span></div>
<div id="box" class="showMenu">
    <ul id="tab">
        <li>
            <img id="arrow" ng-click="toggle('arrow');" ng-src="{{fullJson.menuarrow.arrowdown}}"/>
        </li>
    </ul>
    <div id="buttons">
        <div id="deco">
            <ANY ng-if="fullJson.canEdit == true">
                <ANY ng-if="currentComp != null">
                    <button class="bt" ng-click="edit()">Edit</button>
                    <button class="bt" ng-click="open(fullJson.sources)">Add frame</button>
                    <button class="bt" ng-click="deleteComp()">Delete comp</button>
                    <button class="bt" ng-click="renameComp()">Rename comp</button>
                </ANY>
                <button class="bt" ng-click="saveJson()">Save</button>
                <button class="bt" ng-click="addComp()">Add composition</button>
            </ANY>
            <label>Composition
                <select ng-options="comp.name for comp in fullJson.user.compositions"
                        ng-model="currentComp"></select>
            </label>
            <ANY ng-if="fullJson.isLogged == true">
                <button ng-if="fullJson.canEdit == false && currentComp != null" class="bt" ng-click="copyComp()">Copy
                </button>
                <button class="bt" ng-click="logOut()">Logout</button>
                <label>
                    Autosave
                    <input type="checkbox" ng-model="fullJson.user.autoSave">
                </label>
            </ANY>
            <button ng-if="fullJson.isLogged == false" class="bt" ng-click="logIn()">Login</button>
        </div>
    </div>
</div>


<div ng-repeat="frame in currentComp.frames" class="outer">
    <ANY ng-switch on="frame.sourceType">
        <ANY ng-switch-when="0">
            <ANY ng-if="frame.type == 'stream'">
                <object type="application/x-shockwave-flash"
                        ng-style="{'left':frame.positionX, 'top':frame.positionY, 'position': 'absolute', 'width':frame.width, 'height':frame.height}"
                        id="frame{{currentComp.frames.indexOf(frame)}}"
                        data="http://www.twitch.tv/widgets/live_embed_player.swf?channel={CHANNEL}"
                        bgcolor="#000000"
                        wmode="opaque">
                    <param name="allowFullScreen"
                           value="true"/>
                    <param name="allowScriptAccess"
                           value="always"/>
                    <param name="allowNetworking"
                           value="all"/>
                    <param name="movie"
                           value="http://www.twitch.tv/widgets/live_embed_player.swf"/>
                    <param name="flashvars"
                           value="hostname=www.twitch.tv&channel={{frame.streamSource}}&auto_play=false&start_volume=25"/>
                </object>
            </ANY>
            <ANY ng-if="frame.type == 'chat'">
                <iframe frameborder="0"
                        scrolling="no"
                        id="frame{{currentComp.frames.indexOf(frame)}}"
                        ng-src="{{trustSrc('http://twitch.tv/chat/embed?channel='+frame.streamSource+'&amp;popout_chat=true')}}"
                        ng-style="{'left':frame.positionX, 'top':frame.positionY, 'position': 'absolute', 'width':frame.width, 'height':frame.height}">
                </iframe>
            </ANY>
        </ANY>
        <ANY ng-switch-when="1">
            <ANY ng-if="frame.type == 'stream'">
                <iframe id="frame{{currentComp.frames.indexOf(frame)}}" frameborder="0"
                        ng-src="{{trustSrc('http://www.goodgame.ru/player.php?'+frame.streamSource)}}"
                        ng-style="{'left':frame.positionX, 'top':frame.positionY, 'position': 'absolute', 'width':frame.width, 'height':frame.height}">
                </iframe>
            </ANY>
            <ANY ng-if="frame.type == 'chat'">
                <iframe id="frame{{currentComp.frames.indexOf(frame)}}" frameborder="0"
                        ng-src="{{trustSrc('http://www.goodgame.ru/chat/'+frame.streamSource)}}"
                        ng-style="{'left':frame.positionX, 'top':frame.positionY, 'position': 'absolute', 'width':frame.width, 'height':frame.height}">
                </iframe>
            </ANY>
        </ANY>
        <ANY ng-switch-when="2">
            <ANY ng-if="frame.type == 'stream'">
                <iframe id="frame{{currentComp.frames.indexOf(frame)}}" frameborder="0"
                        ng-src="{{trustSrc('http://api.cybergame.tv/p/embed.php?c='+frame.streamSource+'&w='+frame.width+'&h='+frame.height+'&type=embed')}}"
                        ng-style="{'left':frame.positionX, 'top':frame.positionY, 'position': 'absolute', 'width':frame.width, 'height':frame.height}">
                </iframe>
            </ANY>
            <ANY ng-if="frame.type == 'chat'">
                <iframe id="frame{{currentComp.frames.indexOf(frame)}}" frameborder="0"
                        ng-src="{{trustSrc('http://cybergame.tv/cgchat.htm?v=b#'+frame.streamSource)}}"
                        ng-style="{'left':frame.positionX, 'top':frame.positionY, 'position': 'absolute', 'width':frame.width, 'height':frame.height}">
                </iframe>
            </ANY>
        </ANY>
        <ANY ng-switch-when="3">
            <ANY ng-if="frame.type == 'chat'">
                <iframe id="frame{{currentComp.frames.indexOf(frame)}}" frameborder="0"
                        ng-src="{{trustSrc('http://chat.sc2tv.ru/index.htm?channelId='+frame.streamSource+'&fullScreen=1&width='+frame.width+'&height='+frame.height)}}"
                        ng-style="{'left':frame.positionX, 'top':frame.positionY, 'position': 'absolute', 'width':frame.width, 'height':frame.height, 'background-color':'black'}">
                </iframe>
            </ANY>
        </ANY>
    </ANY>
    <div id="edit{{currentComp.frames.indexOf(frame)}}" resizable-draggable class="bar"
         ng-model="currentComp.frames[currentComp.frames.indexOf(frame)]"
         ng-style="{left:frame.positionX, top:frame.positionY, position: 'absolute', width:frame.width, height:frame.height}"
         frame="frame">
        <button class="close" style="font-size: 30px; padding: 10px;" ng-click="$parent.close(currentComp.frames, $index)">X
        </button>
    </div>
</div>
